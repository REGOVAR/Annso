<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Annso</title>


    <!-- Base -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-migrate-3.0.0.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script type="text/javascript" src="/assets/jquery.tablesorter.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


    <!-- Form generator -->
    <link rel="stylesheet" href='/assets/brutusin/css/brutusin-json-forms.min.css'/>
    <script src="/assets/brutusin/js/brutusin-json-forms.min.js"></script>

    <!-- Autocomplete input -->
    <script type="text/javascript" src="/assets/typeahead.js"></script>

    <!-- Annso specific -->
    <link rel="stylesheet" href="/assets/annso.css"/>
    <link rel="stylesheet" href="/assets/font-awesome-4.6.3/css/font-awesome.min.css"/>
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-inverse">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="navbar" class="navbar-collapse collapse" aria-expanded="false" style="height: 1px;">
                <ul class="nav navbar-nav">
                    <li><a data-toggle="tab" href="#presentation"><i class="fa fa-eye" aria-hidden="true"></i> Presentation</a></li>
                    <li class="active"><a data-toggle="tab" href="#demo"><i class="fa fa-desktop" aria-hidden="true"></i> Demo</a></li>
                    <li><a data-toggle="tab" href="#api"><i class="fa fa-code" aria-hidden="true"></i> API</a></li>
                    <li><a href="https://annso.readthedocs.io/en/latest/?badge=latest" target="_blanck"><i class="fa fa-question" aria-hidden="true"></i> Help</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>

    <div class="container" role="main" style="width:100%; padding:0; position: absolute; bottom:0; top:50px;">
        <h1 class="content-subhead hidden" style="margin-top:70px"><i class="fa fa-retweet" aria-hidden="true"></i> WS [ <span id="message"></span> ]</h1>
        <div class="tab-content">

            <!--              -->
            <!-- PRESENTATION -->
            <!--              -->
            <div id="presentation" class="tab-pane fade container">
                <h1>Annso !!</h1>
            </div>


            <!--      -->
            <!-- DEMO -->
            <!--      -->
            <div id="demo" class="tab-pane fade in active" style="position: absolute; width:100%; bottom:0; top:0px;" >

                <div id="tus_support_alert" class="alert alert-warining hidden">
                    <b>Warning!</b> Your browser does not seem to support the features necessary to run tus-js-client.
                </div>

                <h2 id="analysis_title" style="color:#999; padding-left:20px;"></h2>
                <div class="panel panel-default" style="padding:0; position: absolute; bottom:0; top:65px; width:100%; margin: 0"> <!-- style="box-shadow: 0 0 10px #ccc; border: 1px solid #ccc;" -->
                    <div class="panel-heading" style="position:relative; padding:0">
                        <!-- <img src="/assets/img/logo.png" width="100px" style="position:absolute; top:-10px; left:-100px;" />  -->



                        <!--                -->
                        <!-- Welcom TOOLBAR -->
                        <!--                -->
                        <div id="welcom_toolbar" style="height:54px;">
                            &nbsp;
                        </div>

                        <!--                -->
                        <!-- SAMPLE TOOLBAR -->
                        <!--                -->
                        <div id="sample_toolbar" class="collapse">

                            <div style="padding:10px; margin-left:75px; border-left: 1px solid #ddd;">
                                <div class="btn-group ">
                                    <a class="btn btn-default" href="#modal_import_sample_db" onclick="javascript:ui.load_sample_database();" title="Add a sample to your analysis" data-toggle="modal">
                                        <i class="fa fa-plus" style="width:20px; text-align:center;" aria-hidden="true"></i> Add sample
                                    </a>
                                </div>
                                &nbsp;
                                <div id="" class="btn-group ">
                                    <a class="btn btn-default" href="#modal_import_ped_file" title="Import PED file" data-toggle="modal">
                                        <i class="fa fa-tag" style="width:20px; text-align:center;" aria-hidden="true"></i> Load PED file
                                    </a>
                                    <a class="btn btn-default" href="#" title="Add custom attribute to sample" onclick="javascript:ui.new_attribute();">
                                        <i class="fa fa-tag" style="width:20px; text-align:center;" aria-hidden="true"></i> Custom attribute
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!--                 -->
                        <!-- VARIANT TOOLBAR -->
                        <!--                 -->
                        <div id="variant_toolbar" class="collapse">
                            <form class="form-inline" style="display:block; float: right; margin: 9px 9px 0 9px;">
                                <span id="variant_qfilter_message" style="color:#999" style="font-style:italic"></span>
                                <span id="variant_qfilter_warning" class="text-danger" style="font-style:italic"></span>
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="fa fa-search" aria-hidden="true"></i></span>
                                    <input id="variant_qfilter_input" type="text" class="form-control" placeholder="Search" aria-describedby="sizing-addon1">
                                </div>
                            </form>
                            <div style="padding:10px; margin-left:75px; border-left: 1px solid #ddd;">
                                <div id="view_selection" class="btn-group" data-toggle="buttons">
                                    <label class="btn btn-default" onclick="javascript:ui.select_view('quick');">
                                        <input type="radio">  <i class="fa fa-bolt" aria-hidden="true"></i>
                                    </label>
                                    <label class="btn btn-default active" onclick="javascript:ui.select_view('filter');">
                                        <input type="radio">  <i class="fa fa-filter" aria-hidden="true"></i>
                                    </label>
                                </div>
                                &nbsp;
                                <button class="btn btn-default" title="Choose whitch annotations shall be displayed" href="#modal_field_selector" data-toggle="modal">
                                    <i class="fa fa-info" aria-hidden="true"></i> Columns
                                </button>
                                <!--  &nbsp;
                                <div class="btn-group" data-toggle="buttons">
                                    <label class="btn btn-default active" onclick="javascript:ui.variant_display('table');">
                                        <input type="radio" checked>  <i class="fa fa-table" aria-hidden="true"></i> 
                                    </label>
                                    <label class="btn btn-default" onclick="javascript:ui.variant_display('list');">
                                        <input type="radio">  <i class="fa fa-list" aria-hidden="true"></i>
                                    </label>
                                </div> -->
                                &nbsp;
                                <div class="btn-group">
                                    <button class="btn btn-default" title="Reset filter (display all variants)"  onclick="javascript:ui.reset_filter();">
                                        <i class="fa fa-ban" aria-hidden="true">&nbsp;</i> Reset filter
                                    </button>
                                    <button class="btn btn-default" title="Apply current filter" onclick="javascript:ui.apply_filter();">
                                        <i class="fa fa-play" aria-hidden="true">&nbsp;</i> Apply filter
                                    </button>
                                    <button class="btn btn-default" title="Save the current filter " href="#modal_save_filter" data-toggle="modal">
                                        <i class="fa fa-floppy-o" aria-hidden="true"></i> Save filter
                                    </button>
                                </div>
                                &nbsp;
                                <div class="btn-group" role="group">
                                    <button id="show_selection" class="btn btn-default" title="Display the current selection of variant" onclick="javascript:ui.show_selection();">
                                        
                                    </button>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-default dropdown-toggle disable" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Generate a report for the selected variants">
                                            <i class="fa fa-share-square-o" aria-hidden="true"></i> Export <span class="caret"></span>
                                        </button>
                                        
                                        <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                            {% for m in export_modules %}
                                            <li><a onclick="javascript:analysis.export_selection('{{ m['id'] }}');" title="{{ m["description"] }}">{{ m["name"] }}</a></li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Generate a report for the selected variants">
                                            <i class="fa fa-print" aria-hidden="true"></i> Report <span class="caret"></span>
                                        </button>
                                        
                                        <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                            {% for m in report_modules %}
                                            <li><a onclick="javascript:analysis.report_selection('{{ m['id'] }}');" title="{{ m["description"] }}">{{ m["name"] }}</a></li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div id="nav_project" class="sidebar-nav">
                        <nav class="navbar navbar-default" style="">
                            <div class="navbar-collapse collapse" aria-expanded="false" style="height: 1px; padding:0;">
                                
                                <!--                   -->
                                <!-- ANALYSIS TAB MENU -->
                                <!--                   -->
                                <ul class="nav navbar-nav">
                                    <li class="active"><a id="nav_project_welcom" data-toggle="tab" href="#welcom_panel" onclick="javascript:ui.select_tab('welcom');">
                                        <i class="fa fa-folder-open" style="width:20px; text-align:center;" aria-hidden="true"></i> Welcome </a></li>
                                    <li><a id="nav_project_sample" class="hidden" data-toggle="tab" href="#samples_panel" onclick="javascript:ui.select_tab('sample');">
                                        <i class="fa fa-user" style="width:20px; text-align:center;" aria-hidden="true"></i> Samples </a></li>
                                    <li><a id="nav_project_variant" class="hidden" data-toggle="tab" href="#filters_panel" onclick="javascript:ui.select_tab('variant');">
                                        <i class="fa fa-filter" style="width:20px; text-align:center;" aria-hidden="true"></i> Filtering</a></li>
                                </ul>
                            </div>
                        </nav>
                    </div>

                    <div class="panel-body tab-content" style="padding:0; position:absolute; bottom:35px; top:55px; left:75px; right:0; margin:0;">


                        <!--              -->
                        <!-- WELCOM PANEL --> 
                        <!--              -->
                        <div id="welcom_panel" class="tab-pane fade in active">
                            <div class="row" style="margin:0;">
                                <div class="col-md-3" style="margin-left:30px;">
                                    <h3>New analysis</h3>
                                    <ul>
                                        <li>
                                            <a class="btn btn-default" href="#modal_new_analysis" title="Start a new empty analysis" data-toggle="modal">
                                                <i class="fa fa-filter" style="width:20px; text-align:center;" aria-hidden="true"></i> Start new analysis
                                            </a>
                                        </li>
                                    </ul>

                                    {% if templates|length > 0 %}
                                    <h3>New specific analyses</h3>
                                    <ul>
                                        {% for t in templates %}
                                        <li>
                                            <a class="btn btn-default" onclick="javascript:ui.set_template({{t["id"]}});" title="Start a new analysis with {{t["name"]}} filters predifined">
                                                <i class="fa fa-filter" style="width:20px; text-align:center;" aria-hidden="true"></i> Start {{ t["name"] }} analysis
                                            </a>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}
                                </div>
                                <div class="col-md-3">
                                    <h3>Open analysis</h3>
                                    <ul>
                                        <li>
                                            <a class="btn btn-default" href="#" title="Open an existing analysis" data-toggle="modal">
                                                <i class="fa fa-folder-open" style="width:20px; text-align:center;" aria-hidden="true"></i> Open analysis
                                            </a>
                                        </li>
                                    </ul>

                                    {% if analysis|length > 0 %}
                                    <h3>Recent analysis</h3>
                                    <ul>
                                        {% for a in analysis %}
                                        <li>
                                            <a class="btn btn-default" onclick="javascript:analysis.load_analysis({{a["id"]}});" title="Open " data-toggle="modal">
                                                <i class="fa fa-folder-o" style="width:20px; text-align:center;" aria-hidden="true"></i> {{ a["name"] }}
                                            </a>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!--              -->
                        <!-- SAMPLE PANEL --> 
                        <!--              -->
                        <div id="samples_panel" class="tab-pane fade">
                            <div class="row" style="margin:0;">

                                <!--              -->
                                <!-- SAMPLES LIST -->
                                <!--              -->
                                <div id="browser_samples" class="col-md-12" style="height:500px; padding-left:0; padding-right:0; overflow-y: auto;">
                                    <table id="browser_samples_table" class="table table-striped table-bordered" cellspacing="0" width="100%" style="margin:0">
                                        <thead>
                                            <tr>
                                                <th style="width:30px"></th>
                                                <th class="collapse">Subject</th>
                                                <th>Sample</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>



                        <!--               -->
                        <!-- FILTERS PANEL --> 
                        <!--               -->
                        <div id="filters_panel" class="tab-pane fade">
                            <div class="row" style="margin:0;">

                                <!--                    -->
                                <!-- QUICK FILTERS MENU -->
                                <!--                    -->
                                <div id="filters_panel_menu_quick" class="col-md-3 browser-panel collapse">
                                    <a class="btn section" style="display:block; text-align:left;" role="button" data-toggle="collapse" href="#filters_panel_menu_quick_f" aria-expanded="false" aria-controls="filters_panel_menu_quick_f">
                                        <i class="fa fa-cubes" style="width:20px; text-align:center;" aria-hidden="true"></i> Saved filters 
                                        <span style="float:right;"> <i class="fa fa-chevron-right" aria-hidden="true" style="width:20px; text-align:center;"></i></span>
                                    </a>
                                    <div id="filters_panel_menu_quick_f" class="collapse">
                                        <ul>
                                        </ul>
                                    </div>


                                    <a class="btn section" style="display:block; text-align:left;" role="button" data-toggle="collapse" href="#browserNavFiltersPanelFilters_v" aria-expanded="false" aria-controls="browserNavFiltersPanelFilters_v">
                                        <i class="fa fa-filter" style="width:20px; text-align:center;" aria-hidden="true"></i> Localisation
                                        <span style="float:right;"> <i class="fa fa-chevron-right" aria-hidden="true" style="width:20px; text-align:center;"></i></span>
                                    </a>
                                    <div id="browserNavFiltersPanelFilters_v" class="collapse">
                                        <ul>
                                            <li><a href="#" style="color:#999"><i class="fa fa-eye-slash" style="width:20px; text-align:center;" aria-hidden="true"></i> sample</a></li>
                                            <li><a href="#" style="color:#999"><i class="fa fa-eye-slash" style="width:20px; text-align:center;" aria-hidden="true"></i> chr</a></li>
                                            <li><a href="#" style="color:#999"><i class="fa fa-eye-slash" style="width:20px; text-align:center;" aria-hidden="true"></i> pos</a></li>
                                        </ul>
                                    </div>


                                    <a class="btn section" style="display:block; text-align:left;" role="button" data-toggle="collapse" href="#browserNavFiltersPanelFilters_vtype" aria-expanded="false" aria-controls="browserNavFiltersPanelFilters_vtype">
                                        <i class="fa fa-filter" style="width:20px; text-align:center;" aria-hidden="true"></i> Variant type *
                                        <span style="float:right;"> <i class="fa fa-chevron-right" aria-hidden="true" style="width:20px; text-align:center;"></i></span>
                                    </a>
                                    <div id="browserNavFiltersPanelFilters_vtype" class="collapse">
                                        <ul>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> Substitution</a></li>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> Deletion</a></li>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> Insertion</a></li>
                                            <li><a href="#" style="color:#999"><i class="fa fa-eye-slash" style="width:20px; text-align:center;" aria-hidden="true"></i> CNV</a></li>
                                        </ul>
                                    </div>

                                    <a class="btn section" style="display:block; text-align:left;" role="button" data-toggle="collapse" href="#browserNavFiltersPanelFilters_vregion" aria-expanded="false" aria-controls="browserNavFiltersPanelFilters_vregion">
                                        <i class="fa fa-filter" style="width:20px; text-align:center;" aria-hidden="true"></i> Region *
                                        <span style="float:right;"> <i class="fa fa-chevron-right" aria-hidden="true" style="width:20px; text-align:center;"></i></span>
                                    </a>
                                    <div id="browserNavFiltersPanelFilters_vregion" class="collapse">
                                        <ul>
                                            <li><a href="#" style="color:#999"><i class="fa fa-eye-slash" style="width:20px; text-align:center;" aria-hidden="true"></i> Coding (Gene)</a></li>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> Exon</a></li>
                                            <li><a href="#" style="color:#999"><i class="fa fa-eye-slash" style="width:20px; text-align:center;" aria-hidden="true"></i> Intron</a></li>
                                            <li><a href="#" style="color:#999"><i class="fa fa-eye-slash" style="width:20px; text-align:center;" aria-hidden="true"></i> CDS</a></li>
                                        </ul>
                                    </div>


                                    <a class="btn section" style="display:block; text-align:left;" role="button" data-toggle="collapse" href="#browserNavFiltersPanelFilters_vcoding" aria-expanded="false" aria-controls="browserNavFiltersPanelFilters_vcoding">
                                        <i class="fa fa-filter" style="width:20px; text-align:center;" aria-hidden="true"></i> Coding
                                        <span style="float:right;"> <i class="fa fa-chevron-right" aria-hidden="true" style="width:20px; text-align:center;"></i></span>
                                    </a>
                                    <div id="browserNavFiltersPanelFilters_vcoding" class="collapse">
                                        <ul>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> STOP</a></li>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> Missense</a></li>
                                        </ul>
                                    </div>



                                    <a class="btn section" style="display:block; text-align:left;" role="button" data-toggle="collapse" href="#browserNavFiltersPanelFilters_vexpr" aria-expanded="false" aria-controls="browserNavFiltersPanelFilters_vexpr">
                                        <i class="fa fa-filter" style="width:20px; text-align:center;" aria-hidden="true"></i> Expression
                                        <span style="float:right;"> <i class="fa fa-chevron-right" aria-hidden="true" style="width:20px; text-align:center;"></i></span>
                                    </a>
                                    <div id="browserNavFiltersPanelFilters_vexpr" class="collapse">
                                        <ul>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> Dominant</a></li>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> Recessif</a></li>
                                        </ul>
                                    </div>



                                    <a class="btn section" style="display:block; text-align:left;" role="button" data-toggle="collapse" href="#browserNavFiltersPanelFilters_vgeno" aria-expanded="false" aria-controls="browserNavFiltersPanelFilters_vgeno">
                                        <i class="fa fa-filter" style="width:20px; text-align:center;" aria-hidden="true"></i> Zygosity
                                        <span style="float:right;"> <i class="fa fa-chevron-right" aria-hidden="true" style="width:20px; text-align:center;"></i></span>
                                    </a>
                                    <div id="browserNavFiltersPanelFilters_vgeno" class="collapse">
                                        <ul>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> ref/alt <span style="float:right;">(hetero-ref)</span></a></li>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> alt/alt <span style="float:right;">(homo-alt)</span></a></li>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> alt1/alt2 <span style="float:right;">(hetero-alt)</span></a></li>
                                        </ul>
                                    </div>


                                    <a class="btn section" style="display:block; text-align:left;" role="button" data-toggle="collapse" href="#browserNavFiltersPanelFilters_vprio" aria-expanded="false" aria-controls="browserNavFiltersPanelFilters_vprio">
                                        <i class="fa fa-filter" style="width:20px; text-align:center;" aria-hidden="true"></i> Priorisation *
                                        <span style="float:right;"> <i class="fa fa-chevron-right" aria-hidden="true" style="width:20px; text-align:center;"></i></span>
                                    </a>
                                    <div id="browserNavFiltersPanelFilters_vprio" class="collapse">
                                        <ul>
                                            <li><a href="#" style="color:#999"><i class="fa fa-eye-slash" style="width:20px; text-align:center;" aria-hidden="true"></i> SIFT</a></li>
                                            <li><a href="#" style="color:#999"><i class="fa fa-eye-slash" style="width:20px; text-align:center;" aria-hidden="true"></i> Polyphen2.HDIV </a></li>
                                            <li><a href="#"><i class="fa fa-eye" style="width:20px; text-align:center;" aria-hidden="true"></i> Polyphen2.HVAR < 59
                                                <span style="float:right;"><i class="fa fa-pencil" aria-hidden="true"></i></span></a></li>
                                            <li><a href="#" style="color:#999"><i class="fa fa-eye-slash" style="width:20px; text-align:center;" aria-hidden="true"></i> LTR</a></li>
                                        </ul>
                                    </div>
                                </div>


                                <!--              -->
                                <!-- FILTERS MENU -->
                                <!--              -->
                                <div id="filters_panel_menu_filter" class="col-md-3 browser-panel">
                                    <a class="btn section" style="display:block; text-align:left;" role="button" data-toggle="collapse" href="#filters_panel_menu_filter_f" aria-expanded="true" aria-controls="filters_panel_menu_filter_f">
                                        <i class="fa fa-cubes" style="width:20px; text-align:center;" aria-hidden="true"></i> Saved filters 
                                        <span style="float:right;"> <i class="fa fa-chevron-right" aria-hidden="true" style="width:20px; text-align:center;"></i></span>
                                    </a>
                                    <div id="filters_panel_menu_filter_f" class="">
                                        <ul>
                                        </ul>
                                    </div>

                                    <a class="btn section" style="display:block; text-align:left;" role="button" data-toggle="collapse" href="#filters_panel_menu_filter_c" aria-expanded="true" aria-controls="filters_panel_menu_filter_c">
                                        <i class="fa fa-filter" aria-hidden="true" style="width:20px; text-align:center;">&nbsp;</i> Filter
                                        <span style="float:right;">
                                            <span id="current_filter_count" class="badge"></span>
                                        </span>
                                    </a>
                                    <div id="filters_panel_menu_filter_c" class="complex_filter check">
                                        <ul></ul>
                                    </div>
                                </div>



                                <!--              -->
                                <!-- VARIANT LIST -->
                                <!--              -->
                                <div id="variant_scrolling" class="col-md-9" style="padding-left:0; padding-right:0; overflow-y:auto; position:absolute; right:0; bottom:0; top:0;">
                                    <div id="variants_list"></div>
                                    <div id="selection_list"></div>
                                </div>
                            </div>
                        </div>




                    </div>

                    <div id="demo_footer" class="panel-footer" style="position: absolute; bottom:0; width:100%; margin: 0">&nbsp;</div>
                </div>
            </div>


            <ul id="context_menu" class="dropdown-menu" role="menu" style="display:none" >
                <li><a id="context_menu_info" tabindex="-1" href="#"><i class="fa fa-info-circle" aria-hidden="true"></i> Informations</a></li>
                <li><a id="context_menu_dl" tabindex="-1" href="#"><i class="fa fa-cloud-download" aria-hidden="true"></i> Download</a></li>
            </ul>






            <!--     -->
            <!-- API -->
            <!--     -->
            <div id="api" class="tab-pane fade">
                <h1> Comming soon</h1>
                <ul>
                    <li><a href="https://github.com/REGOVAR/Pirus/blob/master/examples/pipelines/PirusBasic/readme.md">Pipeline creation</a></li>
                    <li><a href="https://github.com/REGOVAR/Pirus/tree/master/docs">Doc</a></li>
                    <li><a href="https://annuel.framapad.org/p/pirusAPI">Pirus API</a></li>
                    <li><a href="https://semestriel.framapad.org/p/annso">Annso API</a></li>
                </ul>
            </div>





            <!--                     -->
            <!-- MODAL POPUP - ERROR -->
            <!--                     -->
            <div id="modal_error" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="panel-danger modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> An error occured !</h4>
                        </div>
                        <div class="modal-body">
                            <p id="modal_error_msg"></p>
                            <ul>
                                <li><b>Error id : </b> <span id="modal_error_id"></span></li>
                                <li><b>Error code : </b> <a id="modal_error_code" href="#" title="Get help for this error" target="_blanck"></a></li>
                            </ul>

                        </div>
                    </div>
                </div>
            </div>




            <!--                            -->
            <!-- MODAL POPUP - New analysis -->
            <!--                            -->
            <div id="modal_new_analysis" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title"><i class="fa fa-folder-open-o" aria-hidden="true"></i> Create a new analysis</h4>
                        </div>
                        <div class="modal-body">

                            <form class="form">
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="fa fa-folder" aria-hidden="true"></i></span>
                                    <input type="text" id="modal_new_analysis_name" placeholder="The name of your analysis" class="form-control">
                                </div>
                                <div class="input-group" style="margin-top:5px;">
                                    Referencial :
                                    <select id="modal_import_file_ref">
                                    {% for ref_id, refname in annotations_db_ref.items() %}
                                        <option value="{{ref_id}}">{{refname}}</option>
                                    {% endfor %}
                                    </select>
                                </div>
                            </form>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button> &nbsp; 
                                <button type="button" class="btn btn-success" onclick="javascript:ui.create_analysis();">Create</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>





            <!--                                   -->
            <!-- MODAL POPUP - DB Sample selection -->
            <!--                                   -->
            <div id="modal_import_sample_db" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title"><i class="fa fa-folder-open-o" aria-hidden="true"></i> Import sample/variant from annso database</h4>
                        </div>
                        <div id="modal_import_sample_db_content" class="modal-body" style="height:450px; padding:0;">
                            <i class="fa fa-refresh fa-spin fa-3x fa-fw" style="margin:200px 250px;"></i><span class="sr-only">Loading data from database</span>
                            

                        </div>
                        <div class="modal-footer">
                            <a class="btn btn-default" style="float:left;" href="#modal_import_sample_file" title="Import sample/variant data from local file" data-toggle="modal">
                                <i class="fa fa-download" style="width:20px; text-align:center;" aria-hidden="true"></i> Import new sample from VCF
                            </a>
                            <button id="modal_new_file_cancel_btn" type="button" class="btn btn-default" data-dismiss="modal">Done</button>
                        </div>
                    </div>
                </div>
            </div>





            <!--                           -->
            <!-- MODAL POPUP - File Upload -->
            <!--                           -->
            <div id="modal_import_sample_file" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title"><i class="fa fa-download" aria-hidden="true"></i> Import sample/variant data from file</h4>
                        </div>
                        <div class="modal-body">

                            <form class="form">
                                <div class="input-group">

                                    <input type="hidden" id="modal_new_file_tus_endpoint" name="modal_new_file_tus_endpoint" value="sample/upload"/>
                                    <input type="hidden" id="modal_new_file_tus_chunksize" name="modal_new_file_tus_chunksize" value="256000"/>

                                    <span class="input-group-addon"><i class="fa fa-file" aria-hidden="true"></i></span>
                                    <input type="file" id="modal_import_file_tus_localinput" class="form-control" />
                                </div>
                            </form>
                            <div id="modal_new_file_details" class="hidden">
                                <h4>File upload</h4>
                                <p id="modal_new_file_progress" style="margin-top:20px; height:50px;"></p>
                                <h4>File import</h4>
                                <p id="modal_new_file_import" style="margin-top:20px; height:50px;"></p>
                                <h4>Finishing</h4>
                                <p>Please wait until we finish to import your file. The popup will automaticaly close when it will be done.</p>
                            </div>
                            <div class="modal-footer">
                                <button id="modal_new_file_cancel_btn" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button> &nbsp; 
                                <button id="modal_new_file_start_btn" type="button" class="btn btn-success" onclick="javascript:ui.tus_upload();">Start import !</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>




            <!--                                    -->
            <!-- MODAL POPUP - PED Sample selection -->
            <!--                                    -->
            <div id="modal_import_ped_file" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title"><i class="fa fa-folder-open-o" aria-hidden="true"></i> Import PED file for this analysis</h4>
                        </div>
                        <div id="modal_import_ped_file_content" class="modal-body" style="height:450px;">
                            <form class="form">
                                <div class="input-group">

                                    <span class="input-group-addon"><i class="fa fa-file" aria-hidden="true"></i></span>
                                    <input type="file" id="modal_import_ped_file" class="form-control">
                                </div>
                            </form>
                            

                        </div>

                        <div class="modal-footer">
                            <button id="modal_import_ped_file_cancel_btn" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button> &nbsp; 
                            <button id="modal_import_ped_file_start_btn" type="button" class="btn btn-success" onclick="javascript:ui.ped_upload();">Load PED file</button>
                        </div>
                    </div>
                </div>
            </div>



            <!--                           -->
            <!-- MODAL POPUP - Save Filter -->
            <!--                           -->
            <div id="modal_save_filter" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title"><i class="fa fa-save" aria-hidden="true"></i> Save the current filter</h4>
                        </div>
                        <div  class="modal-body" style="height:450px; padding:30px;">
                            <input type="text" id="modal_save_filter_name" placeholder="Filter name"/>
                            

                        </div>
                        <div class="modal-footer">
                            <button id="modal_new_file_cancel_btn" type="button" class="btn btn-success" onclick="javascript:ui.save_filter();" >Save</button>
                            <button id="modal_new_file_cancel_btn" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>



            <!--                                  -->
            <!-- MODAL POPUP - Fields annotations -->
            <!--                                  -->
            <div id="modal_field_selector" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document" style="width:1000px;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title"><i class="fa fa-info" aria-hidden="true"></i> Select your annotation's columns</h4>
                        </div>
                        <div class="modal-body">
                            <form class="form-inline" style="margin:10px;">
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="fa fa-search" aria-hidden="true"></i></span>
                                    <input id="browserNavFieldsPanel_filter_input" type="text" class="form-control" placeholder="Search field">
                                </div>
                            </form>
                            
                            <div id="annotation_fields_list" style="overflow:scroll; height:500px; overflow-x:hidden;">
                            
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="javascript:load_variants_array();">Apply</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>




            <!--                                    -->
            <!-- MODAL POPUP - New Filter condition -->
            <!--                                    -->
            <div id="modal_filter_add_condition" class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title"><i class="fa fa-plus" aria-hidden="true"></i> Add new filter condition </h4>
                        </div>


                        <!--                      -->
                        <!-- NEW FILTER - TAB     -->
                        <!--                      -->
                        <div class="new_cond_tree">
                            <ul class="nav navbar navbar-nav">
                                <li><a data-toggle="tab" href="#modal_filter_add_condition_logicals">
                                    <i class="fa fa-indent" style="width:20px; text-align:center;" aria-hidden="true"></i>Logical block</a></li>
                                <li><a data-toggle="tab" href="#modal_filter_add_condition_vfield">
                                    <i class="fa fa-map-marker" style="width:20px; text-align:center;" aria-hidden="true"></i>Field test</a></li>
                                <li><a data-toggle="tab" href="#modal_filter_add_condition_variant">
                                    <i class="fa fa-search" style="width:20px; text-align:center;" aria-hidden="true"></i>Variant</a></li>
                            </ul>
                        </div>


                        <div class="tab-content" style="padding-left:150px; border-right:1px solid #aaa;">
                            <div class="tab-pane fade in active" style="height:500px; padding: 50px;">
                                <i class="fa fa-arrow-left" aria-hidden="true"></i> Build Your test step by step from the left to the right !
                            </div>


                            <!--                      -->
                            <!-- NEW FILTER - LOGICAL -->
                            <!--                      -->
                            <div id="modal_filter_add_condition_logicals" class="tab-pane fade" style="height:500px;">
                                <div class="runConfigTabDescription">Click on the conditionnal block that you want to add</div>
                                
                                <button type="button" class="btn btn-primary" style="display: block; width: 70px; text-align:left; margin: 10px 20px;" onclick="javascript:add_filter_ui('AND');">
                                    AND <i class="fa fa-chevron-right" aria-hidden="true"></i>
                                </button>
                                <button type="button" class="btn btn-success" style="display: block; width: 70px; text-align:left; margin: 10px 20px;" onclick="javascript:add_filter_ui('OR');">
                                    OR <i class="fa fa-chevron-right" aria-hidden="true"></i>
                                </button>
                                <!-- <button type="button" class="btn btn-danger" style="display: block; width: 70px; text-align:left; margin: 10px 20px;" onclick="javascript:add_filter_ui('XOR');">
                                    XOR <i class="fa fa-chevron-right" aria-hidden="true"></i>
                                </button> -->
                            </div>




                            <!--                      -->
                            <!-- NEW FILTER - FIELDS  -->
                            <!--                      -->
                            <div id="modal_filter_add_condition_vfield" class="tab-pane fade" style="height:500px;">
                                <input type="text" id="modal_filter_field_name" placeholder="Field to test"/>

                                <div id="modal_filter_field_form" style="display:inline-block;">
                                </div>
                                

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="javascript:add_filter_ui();">Add</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>
                            </div>


                            <!--                        -->
                            <!-- NEW FILTER - VARIANT   -->
                            <!--                        -->
                            <div id="modal_filter_add_condition_variant" class="tab-pane fade" style="height:500px;">
                                <select name="select" id="modal_filter_variant_type">
                                    <option value="variant">variant</option> 
                                    <option value="site">site</option>
                                </select>
                                <select name="select" id="modal_filter_variant_operator">
                                    <option value="IN">IN</option> 
                                    <option value="NOTIN">Not IN</option>
                                </select>

                                <select name="select" id="modal_filter_variant_set">
                                </select>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="javascript:add_filter_ui2()">Add</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>












            <!--                        -->
            <!-- CONTEXT MENU - Variant -->
            <!--                        -->
            <div id="contextmenu_genename" class="dropdown clearfix collapse">
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu" style="display:block;position:static;margin-bottom:5px;">
                    <li><a data-link="online_tools_variant varsome" href="" target="_blanck">VarSome</a></li>
                    <li><a data-link="online_tools_gene genetest" href="" target="_blanck">GeneTests</a></li>
                    <li><a data-link="online_tools_gene decipher" href="" target="_blanck">Decipher</a></li>
                    <li><a data-link="online_tools_gene cosmic" href="" target="_blanck">Cosmic</a></li>
                    <li><a data-link="online_tools_gene nih_ghr" href="" target="_blanck">NIH Genetics Home Reference</a></li>
                    <li class="divider"></li>
                    <li><a data-link="online_tools_gene hgnc" href="" target="_blanck">HGNC</a></li>
                    <li><a data-link="online_tools_gene genatlas" href="" target="_blanck">GENATLAS</a></li>
                    <li><a data-link="online_tools_gene genecards" href="" target="_blanck">GeneCards</a></li>
                    <li><a data-link="online_tools_gene gopubmed" href="" target="_blanck">GOPubmed</a></li>
                    <li><a data-link="online_tools_gene h_invdb" href="" target="_blanck">H-InvDB</a></li>
                    <li><a data-link="online_tools_gene kegg_patway" href="" target="_blanck">KEGG Pathway</a></li>
                    <li class="divider"></li>
                    <li><a data-link="select">(Un)Select</a></li>
                    <li><a data-link="hide">Hide</a></li>
                    <li><a data-link="details">View details</a></li>
                </ul>
            </div>






















            </div>


        </div>
    </div>


    <script src="/assets/html_snippets.js"></script>
    <script src="/assets/tus.js"></script>
    <script src="/assets/model.js"></script>
    <script src="/assets/gui.js"></script>
    <script>
        var rootURL = "" ; //location.protocol + "//{{ hostname }}";

        var ws = null;
        var $message = $('#message');




        // Annotation fields/databases metadata
        var annotation_fields_formaters = { 
            'f90212dbcd64e391f5569794fbdfe68a' : annotation_format_sampleid,
            '816ce7a58b6918652399342e46143386' : annotation_format_chr,
            '0ec9783c0c626c928005f05956cb3d7b' : annotation_format_pos,
            'de2b02e8a7f3c77cf55efd18e0832f22' : annotation_format_sequence,
            'ab1e6b068bd1618d0422a462df93f28b' : annotation_format_sequence,
            '0b917b488efb09716ade1fab64227ff9' : annotation_format_gt,
            '4394ca9f690ca3e84c20b969bb975269' : annotation_format_dp,

            'b92654754996e36dc866e28585e8ab08' : annotation_format_chr,
            'e7030fb58c6e3021bf712c049a955b72' : annotation_format_pos,
            '8ef79b3244e66acea77a95774f1df6fc' : annotation_format_chr,
            '20eb2930e751cda9d11e27b18168fcc4' : annotation_format_pos,
            '7b0bdcb8fdc88a2ed5512ac885d15e6b' : annotation_format_chr,
            'eb22f43bff7f3d4a0f7c9847d5f8a97d' : annotation_format_pos
        };


        // Internal data for autocomplete form used to filter fields (populated in the ui.start_analysis() js method )
        var annotation_fields = [];
        var annotation_fields_autocomplete = [];
        var annotation_fields_autocomplete_info = [];
        var ctrl_is_pressed = false;

        var query_next_entry_in_progress = false;


        
        $(document).keydown(function(event)
        {
            if(event.which=="17") ctrl_is_pressed = true;
        });

        $(document).keyup(function(event)
        {
            if(event.which=="17") ctrl_is_pressed = false;
        });







        $('#browserNavFieldsPanel_filter_input').keyup(function () 
        { 
            ui.quick_filter_fields_selection($('#browserNavFieldsPanel_filter_input').val());
        });
        $('#modal_filter_field_name').blur(function () 
        { 
            var fuid = annotation_fields_autocomplete_info[annotation_fields_autocomplete.indexOf($('#modal_filter_field_name').val())];
            display_filter_form(fuid);
        });
        





        $("#variant_scrolling").scroll(function() 
        {

            if(!query_next_entry_in_progress && $("#variant_scrolling").scrollTop() > $("#variants_list").height() - $("#variant_scrolling").height()) 
            {
                // if no need to load new entries, do nothing
                if (analysis.analysis.current_count >= analysis.analysis.current_total) return;

                // retrieve list of variant
                query_next_entry_in_progress = true;
                $('#variant_scrolling').css('cursor', 'wait');

                $.ajax({ 
                    url: "{0}/analysis/{1}/filtering".format(rootURL, analysis.analysis.id), 
                    type: "POST",
                    data: "{\"mode\" : \"table\", \"filter\" : " + JSON.stringify(analysis.analysis.filter) + ", \"fields\" : " + JSON.stringify(analysis.analysis.fields) + ", \"order\" : " + JSON.stringify(analysis.analysis.order) + ", \"offset\" : " + current_count +  "}",
                    async: true}).fail(function()
                {
                    display_error("Unknow error in 'load_variants_array' request");
                    query_next_entry_in_progress = false;
                    $('#variant_scrolling').css('cursor', 'default');
                }).done(function(json)
                {
                    if (!json["success"])
                    {
                        display_error(json);
                        query_next_entry_in_progress = false;
                        $('#variant_scrolling').css('cursor', 'default');
                        return;
                    }

                    if (  $("#variants_list_table").length )
                    {
                        update_variants_list(json);
                        $('#demo_footer').html("{2} / {0} variant{1}".format(annotation_format_number(count, false), (count > 1 ? 's' : ''), annotation_format_number(analysis.analysis.current_count)));
                        query_next_entry_in_progress = false;
                        $('#variant_scrolling').css('cursor', 'default');

                        $("#variants_list_table tr").contextMenu({
                            menuSelector: "#contextmenu_genename",
                            menuSelected: function (invokedOn, selectedMenu) 
                            {
                                // var url = selectedMenu[0].getAttribute("href");
                                // var win = window.open(url, '_blank');
                                // win.focus();
                                // return false;
                                // var id = invokedOn[0].parentElement.children[6].innerHTML;
                                // if (action == "context_menu_info") show_tab("browser_file", id);
                                // else if (action == "context_menu_dl") alert("TODO : download the file " + id);
                            }
                        });
                    }
                    else
                    {
                        debugger; // why we arrive here ... 
                        
                    }
                });
            }
        });




        



        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
        /* Context menu
        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
        (function ($, window) 
        {
            $.fn.contextMenu = function (settings) 
            {
                return this.each(function () 
                {

                    // Open context menu
                    $(this).on("contextmenu", function (e) 
                    {
                        // return native menu if pressing control
                        if (e.ctrlKey) return;
                        
                        variant_id = $(e.target).parents("tr").attr('id').split('_')[1];
                        $.ajax({ 
                            url: "{0}/variant/{1}/{2}/{3}".format(rootURL, analysis.analysis.ref, variant_id, analysis.analysis.id), 
                            type: "GET",
                            async: true}).fail(function()
                        {
                            display_error("Unknow error while getting data about variant : {}".format(variant_id));
                        }).done(function(json)
                        {
                            if (json["success"])
                            {
                                json = json['data'];
                                $('#contextmenu_genename a').each( function (idx, elmt) {
                                    var data = $(elmt).attr('data-link').split(' ');
                                    if (data[0] == 'online_tools_variant' || data[0] == 'online_tools_gene')
                                        $(elmt).attr('href', json[data[0]][data[1]]);
                                });
                            }
                            else
                            {
                                alert("variant not found");
                            }
                        });


                        //open menu
                        var $menu = $(settings.menuSelector)
                        .data("invokedOn", $(e.target))
                        .show()
                        .css({
                            position: "absolute",
                            left: getMenuPosition(e.clientX, 'width', 'scrollLeft'),
                            top: getMenuPosition(e.clientY, 'height', 'scrollTop')
                        })
                        .off('click')
                        .on('click', 'a', function (e) {
                            $menu.hide();
                            var $invokedOn = $menu.data("invokedOn");
                            var $selectedMenu = $(e.target);

                            settings.menuSelected.call(this, $invokedOn, $selectedMenu);
                        });
                        
                        return false;
                    });

                    //make sure menu closes on any click
                    $('body').click(function () 
                    {
                        $(settings.menuSelector).hide();
                    });
                });

                function getMenuPosition(mouse, direction, scrollDir) 
                {
                    var win = $(window)[direction](),
                    scroll = $(window)[scrollDir](),
                    menu = $(settings.menuSelector)[direction](),
                    position = mouse + scroll;

                    // opening menu would pass the side of the page
                    if (mouse + menu > win && menu < mouse) 
                        position -= menu;
                    
                    return position;
                }
            };
        })(jQuery, window);



        // $(function() 
        // {
        //     var $contextMenu = $("#contextmenu_genename");

        //     $("body").on("contextmenu", "table tr", function(e) 
        //     {
        //         $contextMenu.css({
        //             display: "block",
        //             left: e.pageX,
        //             top: e.pageY
        //         });
        //         return false;
        //     });

        //     $contextMenu.on("click", "a", function() 
        //     {
        //         $contextMenu.hide();
        //     });

        // });






        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
        /* WEBSOCKETS SESSION
        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

        function ws_onopen()
        {
            $message.attr("class", 'label label-success');
            $message.text('open');

            ws.send('{"msg" : "authent", "data" : "Chrome"}')
        };
        function ws_onmessage(ev)
        {
            $message.attr("class", 'label label-info');
            var json = JSON.parse(ev.data);

            dt = new Date()
            $message.html(dt.toLocaleTimeString() + ' ' + json["msg"] + ' : ' + json["data"]);

            switch(json["msg"])
            {
                case 'import_vcf':
                    $('#modal_new_file_details').removeClass("hidden");
                    buildProgressBar(100, "modal_new_file_progress");
                    json["data"]['progress_percent'];
                    var percentage = json["data"]['progress_percent'];
                    buildProgressBar(percentage, "modal_new_file_import");
                    break;

                case 'import_vcf_end':
                    // clean and close import popup
                    $('#modal_new_file_progress').html("");
                    $('#modal_new_file_import').html("");
                    $('#modal_new_file_details').addClass("hidden");
                    $('#modal_import_sample_file').modal('hide');
                    // automaticaly add sample to the project
                    $.each(json["data"]['samples'], function(id, elmt) 
                    {
                        toggle_select_sample(elmt['id']);
                    });
                    
                    break;


                case 'file_changed':
                    ws_file_changed(json["data"])
                    break;
            }
        };
        function ws_onclose(ev)
        {
            // Try to reconnect websocket every seconds
            setTimeout(ws_setup, 1000);
        };
        function ws_onerror(ev)
        {
            $message.attr("class", 'label label-warning');
            $message.text('error occurred');
        };


        function ws_setup()
        {
            this.ws = new WebSocket((location.protocol == 'https:' ? 'wss://' : 'ws://') + '{{ hostname }}/ws');
            this.ws.onerror = ws_onerror;
            this.ws.onopen = ws_onopen;
            this.ws.onmessage = ws_onmessage;
            this.ws.onclose = ws_onclose;
        }





        $(document).ready(function()
        {
            // Init websocket
            ws_setup();

            // Add tooltips
            $('[data-toggle="tooltip"]').tooltip();

        });
        

        </script>
</body>
</html> 
